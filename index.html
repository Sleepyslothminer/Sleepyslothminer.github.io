<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SleepySloth Miner</title>

    <!-- Firebase v9 Compat Mode (Fixes Import Issues) -->
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-firestore-compat.js"></script>

    <style>
        body {
            font-family: Arial, sans-serif;
            text-align: center;
            background-color: #121212;
            color: white;
        }
        .container {
            max-width: 400px;
            margin: auto;
            padding: 20px;
            border-radius: 10px;
            background-color: #1f1f1f;
            box-shadow: 0px 0px 10px rgba(255, 255, 255, 0.2);
        }
        button {
            padding: 10px 15px;
            font-size: 16px;
            background-color: #00c853;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
        }
        button:disabled {
            background-color: gray;
            cursor: not-allowed;
        }
        #stopButton {
            background-color: #d32f2f;
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>üê® SleepySloth Miner</h1>
        <button onclick="login()">üîë Login with Google</button>
        <p id="user">Not logged in</p>

        <h2>üí∞ Wallet Balance: <span id="walletBalance">0</span> Coins</h2>
        <h3>üèÜ Mining Points: <span id="pointsBalance">0</span> Points</h3>

        <button id="mineButton">‚õèÔ∏è Start Mining</button>
        <button id="stopButton" disabled>üõë Stop Mining</button>
        <p id="status">Mining paused</p>
        <p id="countdown"></p>

        <button onclick="convertPoints()">Convert 100 Points ‚Üí 1 Coin</button>
        <button onclick="deposit()">Deposit +1 Coin</button>
        <button onclick="withdraw()">Withdraw -1 Coin</button>
    </div>

    <script>
        // üîπ Firebase Config (Replace with your Firebase details)
        const firebaseConfig = {
            apiKey: "AIzaSyAU3wcK1qNpgOLIYMTz-XAAPzB__ZAMOH4",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_WEB_APP_ID"
        };

        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        let userId = null;
        let points = localStorage.getItem("balance") ? parseInt(localStorage.getItem("balance")) : 0;
        let mining = localStorage.getItem("mining") === "true";
        let miningStartTime = localStorage.getItem("miningStartTime") ? parseInt(localStorage.getItem("miningStartTime")) : null;
        let miningInterval;
        let countdownInterval;

        document.getElementById("pointsBalance").innerText = points;

        function login() {
            const provider = new firebase.auth.GoogleAuthProvider();
            auth.signInWithPopup(provider).then((userCredential) => {
                userId = userCredential.user.uid;
                document.getElementById("user").innerText = `Logged in as: ${userCredential.user.displayName}`;
                loadWallet();
            }).catch((error) => {
                alert("Login failed: " + error.message);
            });
        }

        function loadWallet() {
            if (!userId) return;
            db.collection("wallets").doc(userId).get().then((doc) => {
                if (doc.exists) {
                    document.getElementById("walletBalance").innerText = doc.data().balance;
                } else {
                    db.collection("wallets").doc(userId).set({ balance: 0 }, { merge: true });
                    document.getElementById("walletBalance").innerText = 0;
                }
            });
        }

        function updateWallet(amount) {
            if (!userId) {
                alert("Please log in first!");
                return;
            }
            db.collection("wallets").doc(userId).get().then((doc) => {
                let newBalance = (doc.exists ? doc.data().balance : 0) + amount;
                if (newBalance < 0) {
                    alert("‚ùå Not enough coins!");
                    return;
                }
                db.collection("wallets").doc(userId).set({ balance: newBalance }, { merge: true });
                document.getElementById("walletBalance").innerText = newBalance;
            });
        }

        function startMining() {
            if (miningInterval) clearInterval(miningInterval);
            if (countdownInterval) clearInterval(countdownInterval);

            mining = true;
            miningStartTime = Date.now();
            localStorage.setItem("mining", "true");
            localStorage.setItem("miningStartTime", miningStartTime.toString());

            document.getElementById("mineButton").disabled = true;
            document.getElementById("stopButton").disabled = false;

            miningInterval = setInterval(() => {
                let elapsed = (Date.now() - miningStartTime) / (1000 * 60 * 60);
                if (elapsed >= 24) {
                    stopMining();
                    return;
                }
                points += 1;
                localStorage.setItem("balance", points);
                document.getElementById("pointsBalance").innerText = points;
            }, 60000);

            startCountdown();
        }

        function stopMining() {
            mining = false;
            localStorage.setItem("mining", "false");
            clearInterval(miningInterval);
            clearInterval(countdownInterval);
            document.getElementById("mineButton").disabled = false;
            document.getElementById("stopButton").disabled = true;
        }

        function startCountdown() {
            countdownInterval = setInterval(() => {
                let remainingTime = 24 - (Date.now() - miningStartTime) / (1000 * 60 * 60);
                if (remainingTime <= 0) {
                    document.getElementById("countdown").innerText = "Mining session complete! Restart to mine again.";
                    clearInterval(countdownInterval);
                } else {
                    let hours = Math.floor(remainingTime);
                    let minutes = Math.floor((remainingTime - hours) * 60);
                    document.getElementById("countdown").innerText = `‚è≥ Time left: ${hours}h ${minutes}m`;
                }
            }, 1000);
        }

        function convertPoints() {
            if (points >= 100) {
                points -= 100;
                localStorage.setItem("balance", points);
                document.getElementById("pointsBalance").innerText = points;
                updateWallet(1);
                alert("‚úÖ Converted 100 Points to 1 Coin!");
            } else {
                alert("‚ùå Not enough points!");
            }
        }

        document.getElementById("mineButton").addEventListener("click", startMining);
        document.getElementById("stopButton").addEventListener("click", stopMining);
    </script>

</body>
</html>
